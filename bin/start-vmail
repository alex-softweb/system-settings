#! /usr/bin/env ruby

vmail_dir = "#{ ENV['HOME'] }/.vmail/**/"

matching_config_path = Dir[vmail_dir].find do |filename|
  filename.match(ARGV[0])
end

if matching_config_path
  puts "using #{ matching_config_path }"
  system "VMAIL_HOME=#{ matching_config_path } vmail"
else
  puts "Your input should match one of the following patterns"
  puts Dir[vmail_dir].map { |dir_name| dir_name.slice(/(?<=\/)\w+(?=\/$)/) }
                     .reject { |dir_name| %w[.vmail default].include?(dir_name) }
end
